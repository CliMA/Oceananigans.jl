# Reactant Correctness Tests - `raise=true` Report

**Julia Version**: 1.11.8  
**Reactant Version**: 0.2.114  
**Test Date**: January 6, 2026  
**Architecture**: CPU (arm64 macOS)

## Summary

Testing `fill_halo_regions!` with `@jit raise=true` on Julia 1.11.8:

| Topology | Result |
|----------|--------|
| (Bounded, Bounded, Bounded) | ✓ PASSED |
| (Periodic, Bounded, Bounded) | ✓ PASSED |
| (Bounded, Periodic, Bounded) | ✓ PASSED |
| (Bounded, Bounded, Periodic) | ✓ PASSED |
| (Periodic, Periodic, Bounded) | ✓ PASSED |
| (Periodic, Bounded, Periodic) | ✓ PASSED |
| (Bounded, Periodic, Periodic) | ✓ PASSED |
| **(Periodic, Periodic, Periodic)** | **✗ SEGFAULT** |

**Pass Rate**: 7/8 (87.5%)

## Key Finding

The **fully periodic topology `(Periodic, Periodic, Periodic)`** triggers a segmentation fault during MLIR pattern rewriting when using `@jit raise=true`. All other topology combinations pass.

## Crash Details

The segfault occurs in `libReactantExtra.dylib` during the `RecognizeRotate` pattern matching pass:

```
[signal 11 (2): Segmentation fault: 11]
in expression starting at ...

_ZNK15RecognizeRotate19matchAndRewriteImplEN4mlir9stablehlo13ConcatenateOpERNS0_15PatternRewriterE 
    at libReactantExtra.dylib (unknown line)
```

The crash happens at compile time (during `@jit` compilation), not during execution.

## Likely Cause

The fully periodic boundary conditions generate MLIR that includes a `ConcatenateOp` pattern which triggers the `RecognizeRotate` optimizer. This pattern matcher appears to have a bug when processing the specific IR generated by triply-periodic halo filling operations.

## Workarounds

1. **Use `raise=false`**: All tests pass with `raise=false` (the default)
2. **Avoid fully periodic grids with `raise=true`**: Use at least one bounded dimension when `raise=true` is required

## Notes

- **CUDA.jl is required**: Even on CPU, `using CUDA` must be loaded for `raise=true` to work with KernelAbstractions kernels. Without it, you get:
  ```
  MethodError: no method matching ka_with_reactant(...)
  Attempted to raise a KernelAbstractions kernel with Reactant but CUDA.jl is not loaded.
  ```

- **`raise=false` works fine**: All 8 topologies pass with `raise=false`

- **This is a Reactant.jl bug**: The issue is in `libReactantExtra.dylib`, not in Oceananigans or Julia

## Recommendation

File an issue on the Reactant.jl GitHub repository with a minimal reproducer demonstrating the segfault with fully periodic grids and `raise=true`.
